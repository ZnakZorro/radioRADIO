[{"id":"d91850fe.3b7fe","type":"inject","z":"67cb59e.07d11a8","name":"Start 10s","topic":"","payload":"10000","payloadType":"num","repeat":"","crontab":"","once":false,"x":190,"y":215,"wires":[["843c20ba.88efa"]]},{"id":"843c20ba.88efa","type":"function","z":"67cb59e.07d11a8","name":"Suwak","func":"global.set(\"akcja\",msg.payload); \n\nvar czasPracy = msg.payload;\nvar okres     = 150; // [ms]\n\n\nvar kierunek  = 1;  // +1 or -1\nvar licznik   = 0;\nvar uchwyt    = null;\n\nString.prototype.pad = function()  {return (\"00000000\" + this).slice(-8);}\n\nfunction suwacz() {\n    if (global.get(\"akcja\")){\n        uchwyt = setTimeout(function(){\n            if (licznik > 7) {\n                licznik=0;\n                val=0;\n                kierunek = kierunek * -1;\n            }\n            var val = 0;\n            if (kierunek===1 ) val =  1   << licznik;\n            if (kierunek===-1) val =  128 >> licznik;\n            licznik++;\n    \t\tvar out = val.toString(2).pad();\n    \t\tnode.send([{payload:val},{payload:out}]);\n            suwacz();\n        }, okres);\n    }\n}\n\nsuwacz();\n\nsetTimeout(function(){\n\tclearTimeout(uchwyt);\n},czasPracy);\n\n//return msg;","outputs":2,"noerr":0,"x":420,"y":175,"wires":[["818a2d9e.cfeb1"],["880d48e0.5e3928","504ed32b.eaea8c"]]},{"id":"818a2d9e.cfeb1","type":"debug","z":"67cb59e.07d11a8","name":"Number","active":false,"console":false,"complete":"payload","x":630,"y":135,"wires":[]},{"id":"655d032c.cfafcc","type":"inject","z":"67cb59e.07d11a8","name":"Long start","topic":"","payload":"3600000","payloadType":"num","repeat":"","crontab":"","once":false,"x":190,"y":135,"wires":[["843c20ba.88efa"]]},{"id":"c7ba6c28.17897","type":"inject","z":"67cb59e.07d11a8","name":"STOP","topic":"","payload":"false","payloadType":"bool","repeat":"","crontab":"","once":false,"x":180,"y":335,"wires":[["843c20ba.88efa"]]},{"id":"fe46f92c.602468","type":"http in","z":"67cb59e.07d11a8","name":"","url":"/suwacz","method":"get","upload":false,"swaggerDoc":"","x":440,"y":415,"wires":[["528d7058.876"]]},{"id":"a76fe71d.dda6b8","type":"http response","z":"67cb59e.07d11a8","name":"","x":920,"y":415,"wires":[]},{"id":"88266fc5.85463","type":"websocket in","z":"67cb59e.07d11a8","name":"bitSuwacz","server":"b5f7b100.4d01","client":"","x":450,"y":315,"wires":[[]]},{"id":"504ed32b.eaea8c","type":"function","z":"67cb59e.07d11a8","name":"no sess","func":"delete msg._session;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":690,"y":315,"wires":[["3959d0ea.f2773"]]},{"id":"3959d0ea.f2773","type":"websocket out","z":"67cb59e.07d11a8","name":"","server":"b5f7b100.4d01","client":"","x":890,"y":315,"wires":[]},{"id":"528d7058.876","type":"template","z":"67cb59e.07d11a8","name":"HTML-suwacz","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\n<html>\n<head>\n<title>Suwacz</title>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width, maximum-scale=1.0, initial-scale=1.0, user-scalable=no\">\n<meta name=\"mobile-web-app-capable\" content=\"yes\">\n<link rel=\"shortcut icon\" sizes=\"128x128\" href=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAMAAABlApw1AAAAmVBMVEX///+w0S6tzi2ZtS2TqzWVrzCjwSz19vGvuYSerGScuSzv8enm6NvV2sPIzq6ptXuTpkioxyygviz5+vbo6t7h5NPQ1brL0bTCyaS3wJOisG6XqFOUp0yTpkSSp0CYsy6Ysi6bty2ryyylxCyeuyzq7OHi5dalsnOSqDqTrDOqyiyeuizy8+zk59nZ3sm9xZ27w5m0vo+bql8KPu0DAAADK0lEQVR42uzZZ26kQBAF4Ho0eSKTSEMYPNnZ9z/c7mq18h9rZaCj1d8JQND1HgVZlmVZlmVZlmVZlmVZlvVTrKdpXpS167UsfjweH2PWem5dFnk6XZPuJruwdJnf4Qudz9wy3E1IW9v3vec7+C/H9/bvW9LQOazjDt/SxXV4Jq0E2fLgoAfnsMwC0sVmcUvQW3JbbEgH24g5GMRhkfrT8BzFGCGOnkmlpwvDSOzyRMq8eeDAeyM1ttUdXNyrLSkQxuAmDkm2TeWAI6fakFQZA2csI4mKBNwlBckSVBCiCkiK6Q2C3KYkwYxBGDYj4dIVBFqlJNjch1D+nISaP0Cwhzl9MvD6xd7BzocE/o4EeTlCiuMLCXFqIElzIgHWLqRx18TfHhLtibuFA4mcBf1m2gAVOUwnLSRrJ8TTEtItiaO8g3RdTtxMGRRgUzMnqIBZmiVQIsmIi8CFIm5gYITxj7NNA2WaDY0XQaGIRjsfoNDhbPYDACIzM4xjml2g2IVGmXhQzJvQGPkdit1zGqOGcjWNMFtBudWMhiuggcLEGsep0qU+NOCnpqbwP5HZbxDgBgbPoFFzKHSgBSc0Zxn0taWpPeizD2n8P+Y7/J3RR2DwISihjZIGWF+hjeua+ju10EZ7MjjGBkfZawJtJK9GbRQ57Rg/oJEPk4vE0DKh0RQFrtSfJh8Df7nUnzZV7g+P+mugkYb6+9XevZ0wDMNgFLahpZASKNkgkLfsv19n8FP0STor5GJb1n90zkCcY51tBmIb69wzEPdY55qBuCo+Af4b4P9C/DrAr8T8XojfjfLnAf5Exp+J+aoEXxfiK3N8bZSvTvv3A/wNDX9HFmcz8at6TxxlKTv2qr0SfLeK3y8U4x16fer2zIX4Dx175b5Rv3P3+f3Q+1u7e93PDww9weFnaPgUk58j45N8fpaST7P6eWI/0c1n6n2rge+V4M0evlvFt9v4fiHe8OQ7tnzLme+Z801/vmvRt136vlHf+Oo7d33rcQLvtG/+9t3rCez3/vyBBBMg/BkcCaagJJhDk2ASUIJZTBmmYWWYR5ZhIlzTNE3TNE3TNE1ThT9BIW+Ji6tqQAAAAABJRU5ErkJggg==\" id=\"shortcut-icon\">\n\n<style>\n\tbody {font-size:16px; font-family:monospace; margin:1rem; padding:0;background:#444; color:white;}\n\t.box {font-size:2rem; letter-spacing: 1.33rem; margin-left: 0.5rem; display:block;}\n\t#blok span{float:left; width:2rem; height:2rem; background:#fff; margin:0.2rem; font-size:2rem;border-radius:1rem;}\n</style>\n</head>\n<body>\n    \n<div class=\"\" id=\"info\"></div>\n<div class=\"box\" id=\"box\"></div>\n<div class=\"\" id=\"blok\">\n    \n\t<span id=\"10000000\"></span>\n\t<span id=\"01000000\"></span>\n\t<span id=\"00100000\"></span>\n\t<span id=\"00010000\"></span>\n\t<span id=\"00001000\"></span>\n\t<span id=\"00000100\"></span>\n\t<span id=\"00000010\"></span>\n\t<span id=\"00000001\"></span>\n\n</div>\n\n\n<script>\n\n    function $(id){return document.getElementById(id);}\n    const $$=(y)=>document.querySelectorAll(y);\n\n\nvar wsUri = \"ws://{{req.headers.host}}/ws/suwacz\";\nvar ws = new WebSocket(wsUri);\n\n    ws.onmessage = function(ev) {\n        $$('#blok span').forEach(function(b){\n            //b.style.background=\"#222\";\n            b.style.opacity=\"0.1\";\n        })\n        //console.log(ev.data);\n        $('box').innerHTML = ev.data;\n        //$(ev.data).style.background=\"#f4f4f4\";\n        $(ev.data).style.opacity=\"1\";\n        return;\n    }\n\n\n\n    function sendXY(x,y) {\n        //ws.send(JSON.stringify({x:x,y:y}));\n    }\n    \n    ws.onopen = function(ev) {\n        writeStatus(null,null,'[Connected]');\n    };\n    \n    ws.onclose = function(ev) {\n        writeStatus(null,null,'[Disconnected]');\n    }\n\n    function writeStatus(x,y,tx){\n        $('info').innerHTML = tx;\n        //console.log(scale,x,y,tx)\n        //sendXY(x,y);\n    }\n \n</script>\n\n</body>\n</html>\n","x":670,"y":415,"wires":[["a76fe71d.dda6b8"]]},{"id":"880d48e0.5e3928","type":"debug","z":"67cb59e.07d11a8","name":"String bits","active":false,"console":false,"complete":"payload","x":630,"y":195,"wires":[]},{"id":"b5f7b100.4d01","type":"websocket-listener","z":"","path":"/ws/suwacz","wholemsg":"false"}]
