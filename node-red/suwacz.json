[{"id":"dbb9276d.f00148","type":"inject","z":"eba3352b.cc4be8","name":"Start 10s","topic":"","payload":"10000","payloadType":"num","repeat":"","crontab":"","once":false,"x":180,"y":240,"wires":[["9b8b8bdb.9fd6a8"]]},{"id":"9b8b8bdb.9fd6a8","type":"function","z":"eba3352b.cc4be8","name":"Suwak","func":"global.set(\"akcja\",msg.payload); \n\nvar czasPracy = msg.payload;\nvar okres     = 100; // 100 ms\nvar kierunek  = 1;  // +1 or -1\nvar licznik   = 0;\nvar uchwyt    = null;\n\nString.prototype.pad = function()  {return (\"00000000\" + this).slice(-8);}\n\nfunction suwacz() {\n    //console.log(global.get(\"akcja\"));\n    if (global.get(\"akcja\")){\n        uchwyt = setTimeout(function(){\n            var val = 0;\n            if (kierunek===1 ) val =  1   << licznik;\n            if (kierunek===-1) val =  128 >> licznik;\n            if (licznik === 8) {\n                licznik=0;\n                val=0;\n                kierunek = kierunek * -1;\n            }\n            licznik++;\n    \t\tvar out = val.toString(2).pad();\n    \t\tnode.send({payload:out});\n    \t\t//node.send({payload:val});\n            suwacz();\n        }, okres);\n    }\n}\n\nsuwacz();\n\nsetTimeout(function(){\n\tclearTimeout(uchwyt);\n\tnode.send({payload:'00000000'});\n},czasPracy);\n\n//return msg;","outputs":1,"noerr":0,"x":385.9999885559082,"y":175.99995803833008,"wires":[["d22d41de.12edb","e71dee49.f7f51","a82fe784.d35398"]]},{"id":"d22d41de.12edb","type":"debug","z":"eba3352b.cc4be8","name":"","active":false,"console":"false","complete":"false","x":603.0000457763672,"y":173.99995803833008,"wires":[]},{"id":"2b79f7d8.ff2518","type":"inject","z":"eba3352b.cc4be8","name":"Start 5s","topic":"","payload":"5000","payloadType":"num","repeat":"","crontab":"","once":false,"x":171.89998626708984,"y":183.99996089935303,"wires":[["9b8b8bdb.9fd6a8"]]},{"id":"c9721e97.f819e","type":"inject","z":"eba3352b.cc4be8","name":"One shot","topic":"","payload":"1800","payloadType":"num","repeat":"","crontab":"","once":false,"x":179.89998626708984,"y":83.99996376037598,"wires":[["9b8b8bdb.9fd6a8"]]},{"id":"717d1b5f.29d234","type":"inject","z":"eba3352b.cc4be8","name":"Two shot","topic":"","payload":"3500","payloadType":"num","repeat":"","crontab":"","once":false,"x":179.89998245239258,"y":133.9999599456787,"wires":[["9b8b8bdb.9fd6a8"]]},{"id":"7eec9d92.fffd14","type":"inject","z":"eba3352b.cc4be8","name":"Long start","topic":"","payload":"3600000","payloadType":"num","repeat":"","crontab":"","once":false,"x":175.89998626708984,"y":338.9999523162842,"wires":[["9b8b8bdb.9fd6a8"]]},{"id":"e71dee49.f7f51","type":"ui_text","z":"eba3352b.cc4be8","group":"233cb023.b4479","order":3,"width":"0","height":"0","name":"","label":"text","format":"{{msg.payload}}","layout":"col-center","x":613.8999710083008,"y":258.999942779541,"wires":[]},{"id":"b44b534d.76593","type":"inject","z":"eba3352b.cc4be8","name":"STOP on 0","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"x":173.8999786376953,"y":419.99995517730713,"wires":[["9b8b8bdb.9fd6a8"]]},{"id":"4cbec8fa.f96278","type":"inject","z":"eba3352b.cc4be8","name":"STOP on false","topic":"","payload":"false","payloadType":"bool","repeat":"","crontab":"","once":false,"x":187.8999786376953,"y":466.99995613098145,"wires":[["9b8b8bdb.9fd6a8"]]},{"id":"b1be6de0.543cb","type":"http in","z":"eba3352b.cc4be8","name":"","url":"/suwacz","method":"get","upload":false,"swaggerDoc":"","x":330,"y":720,"wires":[["6a9f9bd5.aa0e44","cb5bda67.228ef8"]]},{"id":"3b002938.b4f8c6","type":"http response","z":"eba3352b.cc4be8","name":"","x":810,"y":720,"wires":[]},{"id":"2398edc3.2b8c92","type":"websocket in","z":"eba3352b.cc4be8","name":"bitSuwacz","server":"f4311a67.883848","client":"","x":330,"y":620,"wires":[["910b777b.f875e8"]]},{"id":"a82fe784.d35398","type":"function","z":"eba3352b.cc4be8","name":"no sess","func":"delete msg._session;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":600,"y":620,"wires":[["1f91afe.c56c15"]]},{"id":"1f91afe.c56c15","type":"websocket out","z":"eba3352b.cc4be8","name":"","server":"f4311a67.883848","client":"","x":820,"y":620,"wires":[]},{"id":"6a9f9bd5.aa0e44","type":"debug","z":"eba3352b.cc4be8","name":"","active":false,"console":"false","complete":"false","x":540,"y":700,"wires":[]},{"id":"910b777b.f875e8","type":"debug","z":"eba3352b.cc4be8","name":"","active":true,"console":"false","complete":"false","x":530,"y":540,"wires":[]},{"id":"b0b7bf02.ca483","type":"template","z":"eba3352b.cc4be8","name":"HTML-suwacz","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\n<html>\n<head>\n<title>Touch-move</title>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width, maximum-scale=1.0, initial-scale=1.0, user-scalable=no\">\n<meta name=\"mobile-web-app-capable\" content=\"yes\">\n<link rel=\"shortcut icon\" sizes=\"128x128\" href=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACAAgMAAAC+UIlYAAAADFBMVEX/AAA6AMUAAP9HcEzdT1VqAAAABHRSTlOz6LMA1E37jQAAAEJJREFUeF7tyqENACAMRcFuwHQYRqxhtW5QXBGILzCEvNNnKegQdmofBgKBQOhleJm3gUAgEAhZfHsrEAgEAkGQYQHN/HVbVc8OSwAAAABJRU5ErkJggg==\" id=\"shortcut-icon\">\n\n<style>\n\tbody {font-size:16px; font-family:Verdana; margin:0; padding:0;}\n\t.box{ font-size:2rem;}\n</style>\n</head>\n<body>\n    \n<div class=\"box\" id=\"box\"></div></div>\n\n\n<script>\n\n\n    function writeStatus(x,y,tx){\n        $('box').innerHTML = tx;\n            //console.log(scale,x,y,tx)\n            //sendXY(x,y);\n\n    }\n\nvar wss=null;\n\nfunction $(id){return document.getElementById(id);}\n\n\n\nvar wsUri = \"ws://{{req.headers.host}}/ws/suwacz\";\nvar ws = new WebSocket(wsUri);\nwss=ws;\n\n\n\n    function sendXY(x,y) {\n        //ws.send(JSON.stringify({x:x,y:y}));\n    }\n    \n    ws.onopen = function(ev) {\n        writeStatus(null,null,'[Connected]');\n    };\n    \n    ws.onclose = function(ev) {\n        writeStatus(null,null,'[Disconnected]');\n    }\n\n    ws.onmessage = function(ev) {\n        console.log(ev.data);\n        $('box').innerHTML = ev.data;\n        return;\n\n    }\n\n\n\n \n</script>\n\n</body>\n</html>\n","x":680,"y":780,"wires":[["3b002938.b4f8c6"]]},{"id":"cb5bda67.228ef8","type":"function","z":"eba3352b.cc4be8","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":425.1000061035156,"y":789,"wires":[["b0b7bf02.ca483"]]},{"id":"98df97c.008a868","type":"template","z":"eba3352b.cc4be8","name":"HTML-touch","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\n<html>\n<head>\n<title>Touch-move</title>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width, maximum-scale=1.0, initial-scale=1.0, user-scalable=no\">\n<meta name=\"mobile-web-app-capable\" content=\"yes\">\n<link rel=\"shortcut icon\" sizes=\"128x128\" href=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACAAgMAAAC+UIlYAAAADFBMVEX/AAA6AMUAAP9HcEzdT1VqAAAABHRSTlOz6LMA1E37jQAAAEJJREFUeF7tyqENACAMRcFuwHQYRqxhtW5QXBGILzCEvNNnKegQdmofBgKBQOhleJm3gUAgEAhZfHsrEAgEAkGQYQHN/HVbVc8OSwAAAABJRU5ErkJggg==\" id=\"shortcut-icon\">\n <style type=\"text/css\">{{payload}}</style>\n<style>\n\tbody {font-size:16px; font-family:Verdana; margin:0; padding:0;}\n\t#arrow{line-height:0; }\n.box{ \n    background: radial-gradient(at 50% 50%, #ffffff 1%, #000000 90%);\n\n}\n</style>\n\n<script>\nvar margines  = 0; \nvar szerokosc = 300;\nvar scale = szerokosc/100;\nvar statusdiv = null;\nvar wss=null;\n\nfunction $(id){return document.getElementById(id);}\nvar arrow=$('arrow');\n\ndocument.addEventListener('DOMContentLoaded', function() {\n/* start of touch-move        */    \n    statusdiv = $('statusdiv');\n    $('container').style.width  = szerokosc+'px';\n    $('container').style.height = szerokosc+'px';\n    $('box1').style.width  = szerokosc+'px';\n    $('box1').style.height = szerokosc+'px';\n    $(\"arrow\").style.top  = (szerokosc/2)+'px';\n    $(\"arrow\").style.left = (szerokosc/2)+'px';\n    var box1 = document.getElementById('box1');\n    \n    var startx = 0;\n    var starty = 0;\n\n    function writeStatus(x,y,tx){\n        if (x && y){\n            x = Math.round(x/scale);\n            y = Math.round(y/scale);\n            //console.log(scale,x,y,tx)\n            statusdiv.innerHTML = x + ' / '+y+' px '+tx;\n            sendXY(x,y);\n        } else {\n            statusdiv.innerHTML = tx;\n        }\n    }\n\n\n    box1.addEventListener('touchstart', function(e){\n        var touchobj = e.changedTouches[0];\n        var startX = parseInt(touchobj.clientX);\n        var startY = parseInt(touchobj.clientY);\n        writeStatus(startX,startY,'Touchstart');\n        e.preventDefault();\n    }, false);\n \n    box1.addEventListener('touchmove', function(e){\n        var touchobj = e.changedTouches[0];\n        var X = parseInt(touchobj.clientX)-margines;// - startx;\n        var Y = parseInt(touchobj.clientY)-margines;// - starty;\n        X=X<0?0:X;\n        Y=Y<0?0:Y;\n        X=X>szerokosc?szerokosc:X;\n        Y=Y>szerokosc?szerokosc:Y;\n        writeStatus(X,Y,'Touchmove');\n        e.preventDefault();\n    }, false);\n\n\n    box1.addEventListener('touchend', function(e){\n        var touchobj = e.changedTouches[0];\n        var X = parseInt(touchobj.clientX);\n        var Y = parseInt(touchobj.clientY);\n        writeStatus(X,Y,'Touchend');\n        e.preventDefault();\n    }, false);\n    \n\n     box1.addEventListener('mousemove', function(e){\n        var touchobj = e;\n        var X = parseInt(touchobj.clientX)-margines;// - startx;\n        var Y = parseInt(touchobj.clientY)-margines;// - starty;\n        X=X<0?0:X;\n        Y=Y<0?0:Y;\n        X=X>szerokosc?szerokosc:X;\n        Y=Y>szerokosc?szerokosc:Y;\n        writeStatus(X,Y,'Mousemove');\n        e.preventDefault();\n    }, false);   \n    \n    \n/* end of touch-move        */\n\n\n/* start of socked        */\n/* ========================================================= */\n\n\nvar wsUri = \"ws://{{req.headers.host}}/ws/suwacz\";\nvar ws = new WebSocket(wsUri);\nwss=ws;\nvar color='red';\nvar radio = 1;\nvar slider=50;\n\n\n    function sendXY(x,y) {\n        //ws.send(JSON.stringify({x:x,y:y}));\n    }\n    \n    ws.onopen = function(ev) {\n        writeStatus(null,null,'[Connected]');\n    };\n    \n    ws.onclose = function(ev) {\n        writeStatus(null,null,'[Disconnected]');\n    }\nvar deg2rad = Math.PI/180;\nvar rad2deg = 180/Math.PI;\n\n    ws.onmessage = function(ev) {\n        console.log(ev.data);\n        return;\n        var payload = JSON.parse(ev.data);\n        //console.log('payload=',payload);\n        var arrow = $('arrow');\n            //var deg = payload.x - 50;\n            var x = payload.x-50;\n            var y = 50 - payload.y;\n            var tanges = x/y;\n            var deg = Math.atan(tanges) * rad2deg;\n            //console.log(0,x,y,'tan='+tanges,'deg='+Math.round(deg))\n            if(y<0) deg -=180;\n            //console.log(1,x,y,'tan='+tanges,'deg='+Math.round(deg))\n        //arrow.style.webkitTransform = \"rotate(\"+deg+\"deg)\";\n        \n        var siz = 2*Math.round(Math.sqrt((x*x)+(y*y))) ;\n        //arrow.style.fontSize = siz + 'px';\n        var s= siz/10;\n        arrow.style.webkitTransform = \"rotate(\"+deg+\"deg) scale(\"+s+\")\";\n        //arrow.style.webkitTransform = \"translateX(\"+size+\"px)\";\n        //arrow.style.webkitTransform = \"translateY(\"+size+\"px)\";\n\n\n        //arrow.style.left = (100-(siz)+(siz/2)) + 'px';\n        //arrow.style.top  = (100-(siz)-(siz/2)) + 'px';\n        //arrow.style.left = ((100-siz)) + 'px';\n        //arrow.style.top  = ((100-siz)) + 'px';\n\n    }\n\n/* end of socked        */\n    \n}); \n\nfunction buttonClick(that){\n    console.log(that.dataset.x,that.dataset.y);\n    wss.send(JSON.stringify({x:that.dataset.x,y:that.dataset.y}));\n}\n \n</script>\n\n</head>\n<body>\n\t<div id=\"container\" style=\"position:relative; margin:0px; width:240px; height:240px;\" >\n\t\t<div class=\"box\" id=\"box1\" style=\"border:1px; position:absolute;top:0; left:0; width:240px; height:240px; opacity:0.75;\">\t\t</div>\n\t    <div id=\"arrow\" style=\"position:absolute; left:100px;top:100px;font-size:15px; transform:rotate(0deg);\">&uarr;</div>\n\t</div>\n\t\n\t<h3 id=\"statusdiv\">Touch and move</h3>\n\t<div id=\"arr\" style=\"position:relative; left:100px; top:10px; \" >\n    <table>\n\t    <tr>\n\t        <td><button onClick=\"buttonClick(this)\" data-x=10 data-y=10>&nwarr;</button></td>\n\t        <td><button onClick=\"buttonClick(this)\" data-x=50 data-y=10>&uarr;</button></td>\n\t        <td><button onClick=\"buttonClick(this)\" data-x=90 data-y=10>&nearr;</button></td>\n\t    </tr>\n\t    <tr>\n\t        <td><button onClick=\"buttonClick(this)\" data-x=10 data-y=50>&larr;</button></td>\n\t        <td><button onClick=\"buttonClick(this)\" data-x=51 data-y=51>&equals;</button></td>\n\t        <td><button onClick=\"buttonClick(this)\" data-x=90 data-y=50>&rarr;</button></td>\n\t    </tr>\n\t    <tr>\n    \t    <td><button onClick=\"buttonClick(this)\" data-x=10 data-y=90>&swarr;</button></td>\n    \t    <td><button onClick=\"buttonClick(this)\" data-x=50 data-y=90>&darr;</button></td>\n\t        <td><button onClick=\"buttonClick(this)\" data-x=90 data-y=90>&searr;</button></td>\n\t    </tr>\n    </table>\n    </div>\t    \n\t\n\t\n</body>\n</html>\n","x":270,"y":840,"wires":[[]]},{"id":"47d66eec.e1561","type":"template","z":"eba3352b.cc4be8","name":"CSS","field":"payload","fieldType":"msg","format":"css","syntax":"plain","template":"\n  * {\n    font-family: 'Palatino Linotype', 'Book Antiqua', Verdana,Palatino, serif;\n    \n    font-size: 1.2em;\n  }\n\n  html, body, #wrapper {\n    margin: 0;\n    padding: 0;\n    height: 100%;\n  }\n\n  #wrapper {\n    background-color: #ecf0f1;\n  }\n\n  #chat_box {\n    box-sizing: border-box;\n    height: 100%;\n    overflow: auto;\n    padding-bottom: 50px;\n  }\n\n  #footer {\n    box-sizing: border-box;\n    position: fixed;\n    bottom: 0;\n    height: 50px;\n    width: 100%;\n    background-color: #2980b9;\n  }\n\n  #footer .content {\n    padding-top: 4px;\n    position: relative;\n  }\n\n  #user { width: 20%; }\n  #message { width: 68%; }\n  #send_btn {\n    width: 10%;\n    position: absolute;\n    right: 0;\n    bottom: 0;\n    margin: 0;\n  }\n\n  .content {\n    width: 70%;\n    margin: 0 auto;\n  }\n\n  input[type=\"text\"],\n  input[type=\"button\"] {\n    border: 0;\n    color: #fff;\n  }\n\n  input[type=\"text\"] {\n    background-color: #146EA8;\n    padding: 3px 10px;\n  }\n\n  input[type=\"button\"] {\n    background-color: #f39c12;\n    border-right: 2px solid #e67e22;\n    border-bottom: 2px solid #e67e22;\n    min-width: 70px;\n    display: inline-block;\n  }\n\n  input[type=\"button\"]:hover {\n    background-color: #e67e22;\n    border-right: 2px solid #f39c12;\n    border-bottom: 2px solid #f39c12;\n    cursor: pointer;\n  }\n\n  .system,\n  .username {\n    color: #aaa;\n    font-style: italic;\n    font-family: monospace;\n    font-size: 16px;\n  }\n\n  @media(max-width: 1000px) {\n    .content { width: 90%; }\n  }\n\n  @media(max-width: 780px) {\n    #footer { height: 91px; }\n    #chat_box { padding-bottom: 91px; }\n\n    #user { width: 100%; }\n    #message { width: 80%; }\n  }\n\n  @media(max-width: 400px) {\n    #footer { height: 135px; }\n    #chat_box { padding-bottom: 135px; }\n\n    #message { width: 100%; }\n    #send_btn {\n      position: relative;\n      margin-top: 3px;\n      width: 100%;\n    }\n  }\n\nbutton {\n  border: solid 1px #ccc;\n  border-radius: 8px;\n  color: #fff;\n  background-image: linear-gradient(#5187c4, #1c2f45);\n  background-size: auto 200%;\n  background-position: 0 100%;\n  transition: background-position 0.5s;\n    font-size:0.95rem;\n    color:#eee;\n    background-image: linear-gradient(#5187c4, #1c2f45);\n    background-size: auto 200%;\n    background-position: 0 100%;\n    transition: background-position 0.5s;\n    padding:0.33rem;\n    margin:0.25rem;\n    min-width:2rem;  \n    line-height:1.5em;\n}\nbutton:hover {\n    color:#fff;\n    background-position: 0 0;\n}\n\n:focus {\noutline: 0;\n}\n\n\ntr {margin:0; padding:0;}\ntd {margin:0; padding:0;}\ntable button {margin:0;}","x":130,"y":900,"wires":[["98df97c.008a868"]]},{"id":"233cb023.b4479","type":"ui_group","z":"","name":"Polska","tab":"4b37f382.4d56cc","order":2,"disp":true,"width":"6"},{"id":"f4311a67.883848","type":"websocket-listener","z":"","path":"/ws/suwacz","wholemsg":"false"},{"id":"4b37f382.4d56cc","type":"ui_tab","z":"","name":"Informacje","icon":"dashboard","order":1}]
